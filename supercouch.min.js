/*!
 * SuperCouch
 * Copyright (c) 2012 Jake Luer <jake@qualiancy.com>
 * MIT Licensed
 *
 * @website http://supercou.ch
 * @issues https://github.com/qualiancy/supercouch/issues
 */
var supercouch=function(a,b){function c(a){return a&&"function"==typeof a}function d(a){return a&&"object"==typeof a}function e(a){"[object Array]"==={}.toString.call(a)}function f(a,b){if(a&&b)for(var c in b)a[c]=b[c];return a}function g(a,b){if(a&&b)for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);return a}function h(a){a=a||{},this.reqOpts=a}function i(){var a=this.reqOpts;a.path.join("/").split("/").filter(function(a){return!a.trim.length});var b=a.path.length===1&&a.path[0]=="/"?"":a.path.join("/");return a.base+"/"+b}function j(a,b){"object"==typeof a&&(b=a,a="http://localhost:5984"),b=b||{},this.reqOpts={base:a||"http://localhost:5984"}}function k(a){a=a||{},this.reqOpts=a}return a=function(a){return new j(a)},a.version="0.0.0",h.prototype.end=function(a){var c=this,d=this.reqOpts,e,f=d.method.toUpperCase(),g;if("GET"===f)e=i.call(this),g=b.get(e);else if("POST"===f)e=i.call(this),g=b.post(e);else if("PUT"===f)e=i.call(this),g=b.put(e);else if("DELETE"===f)e=i.call(this),g=b.del(e);else{if("HEAD"!==f)return a(new Error("Unsuppored request method"));e=i.call(this),g=b.head(e)}d.body&&g.send(d.body),g.end(function(c){var d,e=null;if(f==="HEAD")return a(null,c.statusCode!==404);try{d=JSON.parse(c.text)}catch(g){e=g}d.error&&(e=d);if(e)return a(e);a(null,d)})},j.prototype.request=function(a,b,d){var e=f({method:a,path:[b]},this.reqOpts),g=new h(e);return c(d)&&g.end(d),g},j.prototype.action=function(a,b,d){var e={"all dbs":"GET","active tasks":"GET",uuids:"GET",stats:"GET",log:"GET",replicate:"POST",restart:"POST"};if(!e[a])throw new Error("Couch action `"+a+"` not valid");c(b)&&(d=b,data={});var g=e[a],i="_"+a.split(" ").join("_"),j=f({method:g,path:[i],body:b},this.reqOpts),k=new h(j);return c(d)&&k.end(d),k},j.prototype.dbAdd=function(a,b){var d=f({method:"PUT",path:[a]},this.reqOpts),e=new h(d);return c(b)&&e.end(b),e},j.prototype.dbInfo=function(a,b){var d=f({method:"GET",path:[a]},this.reqOpts),e=new h(d);return c(b)&&e.end(b),e},j.prototype.dbExists=function(a,b){var d=f({method:"HEAD",path:[a]},this.reqOpts),e=new h(d);return c(b)&&e.end(b),e},j.prototype.dbDel=function(a,b){var d=f({method:"DELETE",path:[a]},this.reqOpts),e=new h(d);return c(b)&&e.end(b),e},j.prototype.db=function(a){var b=f({path:[a]},this.reqOpts),c=new k(b);return c},k.prototype.action=function(a,b,d){var e={changes:"GET",compact:"POST","view cleanup":"POST","temp view":"POST","ensure full commit":"POST",purge:"POST"};if(!e[a])throw new Error("Couch action `"+a+"` not valid");c(b)&&(d=b,data={});var g=e[a],i="_"+a.split(" ").join("_"),j=f({method:g,body:b},this.reqOpts);j.path.push(i);var k=new h(j);return c(d)&&k.end(d),k},k.prototype.insert=function(a,b){c(a)&&(b=a,a={});var d=f({method:"POST",body:a},this.reqOpts),e=new h(d);return c(b)&&e.end(b),e},k.prototype.get=function(a,b,d){c(b)&&(d=b,b=null);var e=f({method:"GET"},this.reqOpts);e.path.push(a),b&&(e.qs=[{rev:b}]);var g=new h(e);return c(d)&&g.end(d),g},k.prototype.update=function(a,b,e,g){d(b)&&(g=e,e=b,b=null);var i=f({method:"PUT",body:e},this.reqOpts);i.path.push(a),b&&(i.qs=[{rev:b}]);var j=new h(i);return c(g)&&j.end(g),j},a}({},superagent)